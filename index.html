<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vocab Tracker</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:18px;}
    .wrap{max-width:820px;margin:0 auto;}
    .row{display:flex;gap:10px;margin:12px 0;}
    input{flex:1;padding:12px;font-size:16px;}
    button{padding:12px 14px;font-size:16px;}
    .card{border:1px solid #eee;border-radius:14px;padding:12px;margin:10px 0;}
    .muted{color:#666;font-size:13px;}
    .danger{background:#ffecec;border:1px solid #ffb3b3;}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Vocab Tracker</h2>
  <div class="muted">Ingresa palabra en inglés → traducción + significado corto → se guarda en tu historial.</div>

  <div class="row">
    <input id="term" placeholder="Ej: feasible, backlog, accountability..." />
    <button onclick="addTerm()">Guardar</button>
  </div>

  <div id="status" class="muted"></div>
  <div id="list"></div>
</div>

<script>
const STORAGE_KEY = "vocab_items_v1";
const API_URL = "/api/translate";

function loadItems(){ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
function saveItems(items){ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }
function setStatus(msg){ document.getElementById("status").textContent = msg || ""; }

function render(){
  const list = document.getElementById("list");
  const items = loadItems();
  list.innerHTML = "";
  items.forEach((it, idx) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div><b>${escapeHtml(it.term)}</b> <span class="muted">(${new Date(it.ts).toLocaleString()})</span></div>
      <div><b>ES:</b> ${escapeHtml(it.translation_es)}</div>
      <div><b>Significado:</b> ${escapeHtml(it.meaning_es)}</div>
      <div style="margin-top:10px;">
        <button class="danger" onclick="delItem(${idx})">Borrar</button>
      </div>
    `;
    list.appendChild(div);
  });
}

async function addTerm(){
  const termEl = document.getElementById("term");
  const term = termEl.value.trim();
  if(!term) return;

  setStatus("Procesando...");
  try{
    const res = await fetch(API_URL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ term })
    });
    if(!res.ok) throw new Error("Error API: " + res.status);
    const data = await res.json();

    const items = loadItems();
    items.unshift({ term, translation_es: data.translation_es, meaning_es: data.meaning_es, ts: Date.now() });
    saveItems(items);

    termEl.value = "";
    render();
    setStatus("Listo ✅");
  }catch(e){
    console.error(e);
    setStatus("No se pudo traducir/definir. Falta configurar Vercel / API Key.");
  }
}

function delItem(idx){
  const items = loadItems();
  items.splice(idx, 1);
  saveItems(items);
  render();
}

function escapeHtml(s){
  return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
render();
</script>
</body>
</html>
